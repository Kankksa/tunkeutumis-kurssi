# h3 Täysin Laillinen Sertifikaatti


## x) Tiivistystehtävä

### Broken Access Control
- Artikkelissa kuvattiin yleisimpiä pääsynhallinnnan haavoittuvuuksia, kuinka niitä voi estää sekä pari esimerkkiä.
- Pääsynhallinnalla varmistetaan, että käyttäjä voi toimia vain omien valtuuksiensa rajoissa.

### Insecure direct object reference (IDOR)
- Pääsynhallinnan haavoittuvuus tyyppi, jolla voidaan kiertää oikeuksia muokkaamalla URL:ista löytyviä tietoja kuten asiakasnumeroita tai tiedostojen nimiä.

### Path traversal
- Haavoittuvuus, joka mahdollistaa tiedostojen lukemisen palvelimelta. Lähetetään palvelimelle pyyntö ladata tiedosto joka sisältääkin arkaluontoista tietoa.
- Voidaan puolustautua vastaan vahvistamalla käyttäjän syöte, ennen kuin pyyntö suoritetaan.

### Cross-site Scripting (XSS)
- XSS hyökkäyksellä voidaan esiintyä hyökkäyksen uhrina, ja mitä enemmän oikeuksia uhrilla on, sitä enemmän haittaa sillä voidaan saada aikaan.
- Hyökkäyksessä yritetään saada uhri sivustolle linkin kautta, joka sisältää vihamielisen skriptin.


## Tehtävät

### a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan myös kuvat, niitä tarvitaan tämän kerran kotitehtävissä. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimine localhost:lla ilman Foxyproxya)

Asensin zaproskyn komennolla ```sudo apt-get install zaproxy```, ja asentamisen jälkeen avasin sen ```zaproxy``` komennolla.

Sitten loin uuden sertifikaatin menemällä Tools -> Options -> Network -> Server Certificates 

<img width="981" height="574" alt="sertti" src="https://github.com/user-attachments/assets/5945cc4a-13ad-41ac-bd90-ce80944099d5" />

Sertifikaatin luomisen jälkeen importtasin sertifikaatin Firefoxiin, ja asetin ZAPin selaimen proxyksi selaimen verkko asetuksista.

<img width="746" height="256" alt="fox" src="https://github.com/user-attachments/assets/e2f65ac0-3120-4f5f-84bd-e2bb863796b7" />



<img width="1194" height="691" alt="proksi" src="https://github.com/user-attachments/assets/7d9a2a63-d860-4446-85c7-e0b68f69b00b" />

Sitten vielä kuvapyyntöjen sieppaus, Tools -> Options -> Display ja ruksi kohtaan missä kuvista kysyttiin

<img width="978" height="574" alt="kuvat" src="https://github.com/user-attachments/assets/cfc9188b-accb-4faf-916e-d7bc7a0499e6" />

### b) Kettumaista. Asenna "FoxyProxy Standard" Firefox Addon, ja lisää ZAP proxyksi siihen. Käytä FoxyProxyn "Patterns" -toimintoa, niin että vain valitsemasi weppisivut ohjataan Proxyyn. (Läksyssä ohjataan varmaankin PortSwigger Labs ja localhost.)

Asensin FoxyProxyn firefoxin addon kaupasta, ja loin sinne uuden proxyn.

<img width="1226" height="504" alt="kettupettu" src="https://github.com/user-attachments/assets/c1427517-898f-4d3e-9750-6159c845e4d5" />

### c) Reflected XSS into HTML context with nothing encoded

Ensimmäisessä labrassa hakutoiminnossa on haavoittuvaisuus, ja ohjeissa lukee että ratkaisu on suorittaa skripti, joka kutsuu alert funktiota.
Laitoin siis hakukenttään ```<script>alert(1)</script>``` ja haku, jonka jälkeen labra oli suoritettu.

### d) Stored XSS into HTML context with nothing encoded

Toisessa labrassa haavoittuvuus on kommentointi työkalussa, jossa skripti laitettiin tällä kertaa kommentikenttään ja lähetettiin palvelimelle siten.

### e) Selitä esimerkin avulla, mitä hyökkääjä hyötyy XSS-hyökkäyksestä. Alert("Hei Tero!") ei vielä tarjoa kummoista pääsyä.

XSS-hyökkäyksessä hyökkääjä yrittää saada uhrin suorittamaan haitallista koodia selaimessaan, joka johtaisi siihen, että hyökkääjä pääsisi käsiksi uhrin istuntoon.

### f) File path traversal, simple case.

Tehtävässä on verkkokauppa, jossa tulee käyttää haavoittuvuutta kuvien haussa. Hain zapista Get pyynnön kuvalle, ja muokkasin siihen kuvatiedoston kohdalle ```/etc/passwd``` tiedoston ja lähetin uuden haun.

<img width="1072" height="304" alt="pyyntö" src="https://github.com/user-attachments/assets/e860e5e7-2c4e-4fb3-aa6d-9a028a6d457b" />

<img width="883" height="411" alt="vastaus" src="https://github.com/user-attachments/assets/518e6ac3-9c5e-4355-b9db-d8f5838c46d7" />

### g) File path traversal, traversal sequences blocked with absolute path bypass

Tässä tehtävässä erona edelliseen on, että meidän tulee viitata suoraan tiedostoon, koska polun käyttäminen on estetty.

<img width="1285" height="356" alt="esto" src="https://github.com/user-attachments/assets/804347b3-e0f5-40ab-9c36-9100d975681b" />

Viittaamalla suoraan /etc/passwd hakeminen onnistui.

### h) File path traversal, traversal sequences stripped non-recursively

Labrassa tiedostoja hakiessa haut suodattavat filename parametrin path traversalit (../), ja poistaa ne ennenkuin haku suoritetaan. Kun tuplaamme merkit, eli niistä tulee ....//....//....//, suodatetaan jokaisen siirtymän keskeltä ../ ja toinen ../ jää pyyntöön, tämä voitaisiin myös estää ajamalla suodatusta niin kauan ettei suodatettavaa löydy.

<img width="1282" height="330" alt="tuplaus" src="https://github.com/user-attachments/assets/94a0f0ac-8aa4-42aa-a96b-92715ed02800" />

### i) Insecure direct object references

Tehtävässä on tarkoitus hakea toisen käyttäjän salasana sekä kirjautua tämän tunnukselle. Tähän käytämme sivuston live chat ominaisuutta, josta on mahdollista ladata oma keskustelu chat botin kanssa.
Ladattuani keskustelun kokeilin vaihtaa tiedoston nimen 2.txt:stä 1.txt:ksi, ja kappas sieltä löytyi Carlosin keskustelu chat botin kanssa hänen salasanastaan.

<img width="1298" height="424" alt="salasana" src="https://github.com/user-attachments/assets/003f85f3-6867-4ffe-9c9f-b8e4349140c8" />

<img width="843" height="338" alt="carlos" src="https://github.com/user-attachments/assets/4008da6b-9a50-4cb8-aee7-4103b91ec999" />

## Lähteet

https://terokarvinen.com/tunkeutumistestaus/#:~:text=session%20%2Du%201-,h3%20T%C3%A4ysin%20Laillinen%20Sertifikaatti,-x)%20Lue/katso  

https://owasp.org/Top10/A01_2021-Broken_Access_Control/

https://portswigger.net/web-security/access-control/idor 

https://portswigger.net/web-security/file-path-traversal

https://portswigger.net/web-security/cross-site-scripting



