# h2 Lisää vain vesi

## Tiivistystehtävä

### x) Conducting a penetration test with Metasploit
- Kappaleessa alussa käydään läpi metasploitin sekä meterpreterin yleisimpijä komentoja.
- Metasploit on avoimen lähdekoodin hyökkäyskehys, joka mahdollistaa useiden järjestelmien samanaikaisen sörkkimisen.
- Metasploit tekee puhtaan poistumisen hyökätystä kohteesta, mikä helpottaa uudelleen samaan kohteeseen tunkeutumista.
- Metasploitilla skannatessa, se luo ja täyttää tietokantaan tietoja keräämästään tiedosta.

## Harjoitustehtävät

### a) Virtuaalikoneiden yhteydet.
 Koneet oli asennettu jo edellisen viikon tehtävissä, ja verkot kytketty niin, että ne saivat yhteyden toisiinsa mutta eivät internettiin.

 <img width="668" height="704" alt="h2verkko" src="https://github.com/user-attachments/assets/827ee89c-1ef9-463a-b1f0-1e3414dfb1c2" />

 ### b) Metasploit msfconsole
 Metasploitin msfconsole aukesi yksinkertaisella komennolla ```msfconsole```.

### c) Metasploitablen löytäminen porttiskannaamalla
Tämäkin vaihe on jo suoritettu edellisen viikon tehtävissä, eikä IP-osoite ole muuttunut mihinkään.

### d) Perusteellinen skannaus ja tietojen tallennus
Skannaukset tallennettu kahteen eri paikkaan.

<img width="449" height="503" alt="scannaus" src="https://github.com/user-attachments/assets/60ab0b75-2af3-4f27-b9d5-6a5bb6051c3f" />

<img width="1002" height="729" alt="cat food" src="https://github.com/user-attachments/assets/30ccb9b9-3a15-490e-b2e6-ae99f741f1e8" />

### e) Tietokantojen tutkiminen
Hosts ja services tietokantoja voi suodatta erilaisilla parametreillä, kuten -u, joka näyttää auki olevat palvelut, -p johon voi laittaa halutu portit ja näin nähdä ne. 

### f) Tallennustapojen vertailu
Nmapin oma tallennustyökalu ```-oA foo``` tallentaa tiedot helposti selattavaan ja pysyvään muotoon, jota on helppo siirtää paikasta toiseen. 
Metasploitin tietokannat taas ovat suurempia kokonaisuuksia joita on helppo suodattaa sovelluksen sisällä.

### g) Murtautuminen metasploitablen vsftpd-palveluun.
Murtautuminen vsftpd-palveluun aloitetaan komennolla ```use exploit/unix/ftp/vsftpd_234_backdoor```, joka valitsee moduulin jota hyökkäykseen tullaan käyttämään.
Tämän jälkeen asetetaan kohteen IP-osoite ```RHOST <IP-Osoite>``` komennolla sekä portti ```RPORT <portti>``` komennolla.
Sen jälkeen annetaan komento ```exploit```, ja hyökkäys käynnistyy. 

<img width="871" height="743" alt="hakkerointi1" src="https://github.com/user-attachments/assets/4b4c75fc-d2ed-4193-9f10-634fcc74db05" />

### h) Shellin päivittäminen meterpreteriksi 
Kun on avoin shell, siirretään se taka-alalle ctrl+Z näppäin yhdistelmällä. 
Tunkeutumis sessio voidaan päivittää meterpreteriksi ```sessions -u -1``` komennolla, joka päivittää viimeksi aukiolleen session.

### i) Tiedon kaivamista metasploitablesta
Järjestelmään tunkeuduttua voi sen sisältöä alkaa penkomaan, löysin sieltä ainakin ssh avaimet ```/home/user/.ssh``` sekä salasanoja ja tunnuksia ```/etc/shadow```, ```route``` komento näyttää reititystaulukot joista voi olla hyötyä levittäytymisessä.

### j) Murtautuminen toisella menetelmällä
Pääsin tunkeutumaan metasploitable koneeseen käyttämälläe tomcat_mgr_deploy haavoittuvuutta, jonka ohjeet löysin O'Reillyn opaskirjasta. 

<img width="421" height="396" alt="tomkat" src="https://github.com/user-attachments/assets/54d2d2c0-7fb7-4da8-9235-dcff074fe911" />

Tomcat käyttäjän oikeuksilla en kylläkään päässyt mitään mielenkiintoista tutkimaan.

### k) Meterpreterin ominaisuudet
Meterpreterin yksinkertaisia komentoja ovat getuid joka tulostaa kirjautuneen käyttäjän sekä sysinfo joka tulostaa järjestelmän tiedot.

<img width="438" height="153" alt="preter" src="https://github.com/user-attachments/assets/15117cd3-d083-4499-8d86-48f124cae2d9" />

### l) Scriptin tallennus

<img width="867" height="822" alt="scripti" src="https://github.com/user-attachments/assets/eb7d206f-6a6d-4fae-93cc-d2c204585f37" />

## Lähteet

Mastering Metasploit https://learning.oreilly.com/library/view/mastering-metasploit/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-32


Mastering Python for Networking and Security https://learning.oreilly.com/library/view/mastering-python-for/9781788992510/7c019c10-c3b6-4777-abcc-4b04d4595f6b.xhtml

Upgrading shells to Meterpreter https://docs.metasploit.com/docs/pentesting/metasploit-guide-upgrading-shells-to-meterpreter.html


